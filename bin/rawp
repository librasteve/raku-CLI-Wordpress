#!/usr/bin/env raku

use lib '../lib';
use CLI::Wordpress;

enum Command <launch start stop list connect terminate>;

sub MAIN(
    Command $cmd,                           #= One of <launch start stop list connect terminate>
) {
    say $cmd;

    given $cmd {
        when 'launch' {
            Instance.new.launch
        }
        when 'list' {
	    say 'ho';
        }
    #`[
        when 'state' {
            Instance.new( :$s, id => focus-id ).state.say
        }
        when 'setup' {
            Instance.new( :$s, id => focus-id ).setup
        }
        when 'connect' {
            Instance.new( :$s, id => focus-id ).connect.say
        }
        when 'terminate' {
            Instance.new( :$s, id => focus-id ).terminate
        }
        when 'nuke' {
            unless $y {                     # silence check
                my $check = prompt "This will terminate all instances. You sure (y/N)? ";

                unless $check eq 'y' { die "Aborting operation..." }
            }

            for $s.instance-ids -> $id {
                Instance.new( :$s, :$id ).terminate
            }
        }
    #]
    }
}


